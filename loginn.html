<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <style>
      form {
        position: absolute;
        top: 20%;
        left: 35%;
      }
      .logoResim {
        height: auto;
        left: 75px;
        width: 75px;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Firebase Auth</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <nav class="navbar navbar-expand-sm bg-dark navbar-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="final.html">
          <img src="uyglogo.png" class="logoResim" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#collapsibleNavbar"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="collapsibleNavbar">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link" href="final.html">Ana Sayfa</a>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                >İlçeler</a
              >
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="merkez.html">Merkez</a></li>
                <li><a class="dropdown-item" href="ayvalik.html">Ayvalık</a></li>
                <li><a class="dropdown-item" href="balya.html">Balya</a></li>
                <li><a class="dropdown-item" href="bandirma.html">Bandırma</a></li>
                <li><a class="dropdown-item" href="bigadic.html">Bigadiç</a></li>
                <li><a class="dropdown-item" href="burhaniye.html">Burhaniye</a></li>
                <li><a class="dropdown-item" href="dursunbey.html">Dursunbey</a></li>
                <li><a class="dropdown-item" href="edremit.html">Edremit</a></li>
                <li><a class="dropdown-item" href="erdek.html">Erdek</a></li>
                <li><a class="dropdown-item" href="gomec.html">Gömeç</a></li>
                <li><a class="dropdown-item" href="gonen.html">Gönen</a></li>
                <li><a class="dropdown-item" href="havran.html">Havran</a></li>
                <li><a class="dropdown-item" href="ivrindi.html">İvrindi</a></li>
                <li><a class="dropdown-item" href="kepsut.html">Kepsut</a></li>
                <li><a class="dropdown-item" href="manyas.html">Manyas</a></li>
                <li><a class="dropdown-item" href="marmara.html">Marmara</a></li>
                <li><a class="dropdown-item" href="savastepe.html">Savaştepe</a></li>
                <li><a class="dropdown-item" href="sindirgi.html">Sındırgı</a></li>
                <li><a class="dropdown-item" href="susurluk.html">Susurluk</a></li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="etkinlikler.html">Etkinlikler</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="hakkimizda.html">Hakkımızda</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <form id="mainForm" class="w-25 m-4">
      <h2 class="mb-3 text-center">Giriş yap</h2>
      <div class="form-floating mb-3">
        <input
          type="email"
          class="form-control"
          id="EmailInp"
          placeholder="name@example.com"
        />
        <label for="EmailInp">Email adresi</label>
      </div>
      <div class="form-floating mb-3">
        <input
          type="password"
          class="form-control"
          id="PassInp"
          placeholder="Password"
        />
        <label for="PassInp">Şifre</label>
      </div>

      <button
        type="button"
        class="btn btn-primary"
        style="float: right"
        id="ay"
      >
        Oturum aç
      </button>

      <a href="registerr.html"
        ><button type="button" class="btn btn-primary me-2">Kayıt ol</button></a
      >
    </form>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        child,
        get,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
      const firebaseConfig = {
        apiKey: "AIzaSyAI2-U00NY31AzOUL-lv7FLCEHI2DHhzzY",
        authDomain: "giris-1009.firebaseapp.com",
        databaseURL: "https://giris-1009-default-rtdb.firebaseio.com",
        projectId: "giris-1009",
        storageBucket: "giris-1009.appspot.com",
        messagingSenderId: "12819811916",
        appId: "1:12819811916:web:2b028edecd0e4463c6aee9",
      };
      const app = initializeApp(firebaseConfig);
      const db = getDatabase();
      const auth = getAuth(app);
      const dbref = ref(db);

      let EmailInp = document.getElementById("EmailInp");
      let PassInp = document.getElementById("PassInp");
      let mainForm = document.getElementById("ay");

      let SignInUser = (evt) => {
        evt.preventDefault();

        signInWithEmailAndPassword(auth, EmailInp.value, PassInp.value)
          .then((credentials) => {
            get(child(dbref, "UsersAuthList/" + credentials.user.uid)).then(
              (snapshot) => {
                if (snapshot.exists) {
                  sessionStorage.setItem(
                    "user-info",
                    JSON.stringify({
                      firstname: snapshot.val().firstname,
                      lastname: snapshot.val().lastname,
                    })
                  );
                  sessionStorage.setItem(
                    "user-creds",
                    JSON.stringify(credentials.user)
                  );
                  window.location.href = "final.html";
                }
              }
            );
          })
          .catch((error) => {
            alert(error.message);
            console.log(error.code);
            console.log(error.message);
          });
      };
      mainForm.addEventListener("click", SignInUser);
    </script>
  </body>
</html>
